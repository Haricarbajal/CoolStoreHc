<html>

<head>
    <link rel="stylesheet" href="styles/style.css">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<div
    class="flex justify-between items-center bg-white p-4 w-full h-24 bg-gray-500 shadow-[0_5px_45px_-25px_rgba(0,0,0,0.3)]">
    <button popovertarget="botones-paginas" class="text-3xl">‚â°</button>
    <a href="coolStore.html" class="text-3xl">Cool StoreüõçÔ∏è</a>
    <div class="relative inline-block">
        <h1
            class="contador absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full w-6 h-6 flex items-center justify-center">
            0
        </h1>
        <button popovertarget="carrito-compras" class="text-5xl mb-[20px]">üõí</button>
    </div>

    <div popover id="carrito-compras" class="max-h-44 overflow-y-scroll">
        <custom-carrito>
            <template id="template-carrito">
                <li class="list-none">
                    <div class="flex items-center bg-gray-100 p-4 border rounded-md">
                        <!-- Imagen a la izquierda -->
                        <div class="flex-shrink-0">
                            <img class="imagen-carrito w-24 h-auto object-cover rounded-md"
                                src="https://i0.wp.com/viciados.net/wp-content/uploads/2023/05/PlayStation_5_PSP_PS_Vita_2_Console_Portatil_Sony_PS5_2023.webp"
                                alt="Producto">
                        </div>

                        <!-- Contenedor de descripci√≥n -->
                        <div class="contenedor-descripcion flex flex-col justify-between ml-4 w-full">
                            <!-- T√≠tulo y precio -->
                            <div>
                                <h1 class="titulo text-lg font-semibold mb-2">Nombre del Producto</h1>
                                <h1 class="precio text-sm text-gray-600">Precio: $100.00</h1>
                            </div>

                            <!-- Bot√≥n eliminar -->
                            <button
                                class="boton-eliminar mt-4 bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600">
                                ELIMINAR
                            </button>
                        </div>
                    </div>
                </li>
            </template>
            <ul id="resultados"></ul>
        </custom-carrito>
    </div>
    <div popover id="botones-paginas">
        <ul>
            <li>
                <button popovertarget="colores">Color</button>
                <div popover id="colores">
                    <ul>
                        <li>
                            <a href="Colores/colorBlack.html">Black</a>
                        </li>
                        <li>
                            <a href="Colores/colorGray.html">Gray</a>
                        </li>
                        <li>
                            <a href="Colores/colorWhite.html">White</a>
                        </li>
                        <li>
                            <a href="Colores/colorOrange.html">Orange</a>
                        </li>
                        <li>
                            <a href="Colores/colorBlue.html">Blue</a>
                        </li>
                    </ul>
                </div>
            </li>
            <li>
                <button popovertarget="camaras">Camara</button>
                <div popover id="camaras">
                    <ul>
                        <li>
                            <a href="Camara/5mp.html">5MP</a>
                        </li>
                        <li>
                            <a href="Camara/8mp.html">8MP</a>
                        </li>
                        <li>
                            <a href="Camara/12mp.html">12MP</a>
                        </li>
                        <li>
                            <a href="Camara/13mp.html">13MP</a>
                        </li>
                        <li>
                            <a href="Camara/14mp.html">14MP</a>
                        </li>
                        <li>
                            <a href="Camara/16mp.html">16MP</a>
                        </li>
                        <li>
                            <a href="Camara/20mp.html">20MP</a>
                        </li>
                        <li>
                            <a href="Camara/21mp.html">21MP</a>
                        </li>
                        <li>
                            <a href="Camara/48mp.html">48MP</a>
                        </li>
                    </ul>
                </div>
            </li>
        </ul>
    </div>
</div>
<custom-article>
    <!-- Fondo con imagen -->
    <div class="min-h-screen flex items-center justify-center p-8 bg-cover bg-center bg-no-repeat"
        style="background-image: url('imagenes/fondo-articulo.jpg');">
        <div
            class="bg-white bg-opacity-80 p-8 rounded-lg shadow-xl w-full max-w-6xl grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Imagen a la izquierda -->
            <div class="flex justify-center items-center">
                <img class="imagen w-full max-w-sm h-auto object-cover rounded-lg shadow-md" src="" alt="Producto">
            </div>
            <!-- Caracter√≠sticas a la derecha -->
            <div class="flex flex-col justify-center items-center text-center space-y-4">
                <h1 class="Descricion text-3xl font-bold">Descripci√≥n</h1>
                <h1 class="precio text-xl">Precio üí∂: <span class="text-blue-600 font-bold"></span></h1>
                <h1 class="caracteristicas text-2xl font-semibold">Caracter√≠sticas üì≤:</h1>
                <ul class="list-disc pl-6 space-y-2">
                    <li class="color">Color üé®: <span class="text-blue-600 font-bold"></span></li>
                    <li class="camara">C√°mara üì∑: <span class="text-blue-600 font-bold"></span></li>
                    <li class="flight-time">Tiempo de vuelo ‚úàÔ∏è: <span class="text-blue-600 font-bold"></span></li>
                    <li class="range">Alcance ü™ô: <span class="text-blue-600 font-bold"></span></li>
                    <button id=""
                        class="comprar mb-2 self-center bg-blue-500 text-black px-6 py-3 rounded-lg text-lg font-semibold hover:bg-blue-600 transition-colors duration-300">Comprar</button>
                </ul>
            </div>
        </div>
    </div>
</custom-article>

<script>
    const customCard = document.querySelector('custom-carrito');
    let contador = parseInt(localStorage.getItem("contador") || 0)
    console.log(contador);
    const numeroAumentar = document.querySelector('.contador');


    const getId = () => {
        const searchParams = new URLSearchParams(location.search.slice(1));
        return Number(searchParams.get('id'));
    }

    class CustomArticle extends HTMLElement {
        constructor() {
            super();
            this.id = getId();
        }
        connectedCallback() {
            this.generarArticulos();
        }

        async generarArticulos() {
            try {
                const response = await fetch('https://products-foniuhqsba-uc.a.run.app/Drones');
                if (!response.ok) {
                    throw new Error('Error al cargar los articulos');
                }
                const articles = await response.json();
                this.mostrarNoticia(articles)
            } catch (error) {
                console.error('Error', error);
            }
        }

        mostrarNoticia(articles) { // Cambi√© el par√°metro a `articles` porque parece que es una lista
            const precio = this.querySelector('.precio');
            const imagen = this.querySelector('.imagen');
            const color = this.querySelector('.color');
            const camara = this.querySelector('.camara');
            const flight_time = this.querySelector('.flight-time');
            const range = this.querySelector('.range');
            const id = getId(); // Obtiene el ID de la URL            
            const boton_comprar = this.querySelector('.comprar');

            // console.log(id);


            //bau   
            const selectedArticle = articles.find((item) => item.id === id);


            if (selectedArticle) {

                // console.log("Art√≠culo encontrado:", selectedArticle);
                // Aqu√≠ puedes renderizar o procesar el art√≠culo encontrado
                imagen.src = selectedArticle.image
                precio.innerHTML += selectedArticle.price;
                color.innerHTML += selectedArticle.features[0].value;
                camara.innerHTML += selectedArticle.features[1].value;
                flight_time.innerHTML += selectedArticle.features[2].value;
                range.innerHTML += selectedArticle.features[3].value;
                boton_comprar.id = id;
                numeroAumentar.textContent = contador;
            } else {
                console.log(`No se encontr√≥ ning√∫n art√≠culo con ID: ${id}`);
            }

            boton_comprar.addEventListener("click", element => {
                contador++;
                localStorage.setItem('contador', contador)
                numeroAumentar.textContent = contador;
                let productos = JSON.parse(localStorage.getItem("productos")) || [];
                productos.push({
                    id: selectedArticle.id,
                    image: selectedArticle.image,
                    title: selectedArticle.title,
                    price: selectedArticle.price
                });
                localStorage.setItem("productos", JSON.stringify(productos));
                    console.log("se agrego el dron");
                    console.log(localStorage.getItem("productos"))

                    console.log(productos)

                    if (customCard) {
                        customCard.a√±adirPopover();
                    }
            })
        }

    }

    customElements.define('custom-article', CustomArticle);

    class Carrito extends HTMLElement {
        constructor() {
            super();
        }

        connectedCallback() {
            this.a√±adirPopover();
        }

        a√±adirPopover() {
            const elementos = JSON.parse(localStorage.getItem("productos") || "[]");
            const resultados = this.querySelector('#resultados');
            resultados.innerHTML = '';  // Limpiar el carrito antes de a√±adir los productos.

            const template = this.querySelector("#template-carrito").content;

            elementos.forEach(elemento => {
                const lista = template.querySelector("li").cloneNode(true);
                lista.querySelector('.imagen-carrito').src = elemento.image;
                lista.querySelector('.titulo').textContent = elemento.title;
                lista.querySelector('.precio').textContent = elemento.price;

                // Asignar un `data-id` al bot√≥n de eliminar para poder identificar el producto
                const botonEliminar = lista.querySelector('.boton-eliminar');
                botonEliminar.setAttribute('data-id', elemento.id);

                // A√±adir el producto al carrito en el DOM
                resultados.appendChild(lista);

                // Agregar el evento de eliminaci√≥n para este bot√≥n de eliminar
                botonEliminar.addEventListener("click", (event) => {
                    contador--;
                    if (contador <= 0) {
                        contador = 0
                        alert("el carrito esta vacio")
                    }
                    numeroAumentar.textContent = contador
                    localStorage.setItem("contador", contador)
                    const productoId = event.target.getAttribute('data-id');  // Obtener el ID del producto a eliminar
                    this.eliminarDelCarrito(productoId, lista);
                });
            });
        }

        eliminarDelCarrito(productoId, lista) {
            let productos = JSON.parse(localStorage.getItem("productos") || "[]");

            for (let i = 0; i < productos.length; i++) {
                if (productos[i].id == productoId) {
                    productos.splice(i, 1);
                    console.log("Producto eliminado del array");
                    break;
                }
            }


            localStorage.setItem("productos", JSON.stringify(productos));

            // Elimina el producto del DOM
            lista.remove();



            console.log("Producto eliminado con √©xito");
        }
    }

    customElements.define('custom-carrito', Carrito);
</script>

</html>